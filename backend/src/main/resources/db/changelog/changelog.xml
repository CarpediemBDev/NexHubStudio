<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="1-create-user-table" author="copilot">
        <createTable tableName="users">
            <column name="id" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)"/>
            <column name="dept" type="varchar(50)"/>
            <column name="role" type="varchar(50)"/>
            <column name="email" type="varchar(100)"/>
            <column name="phone" type="varchar(30)"/>
            <column name="status" type="varchar(20)"/>
            <column name="password" type="varchar(255)"/>
            <column name="last_login_at" type="timestamp"/>
            <column name="created_by" type="varchar(50)"/>
            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_by" type="varchar(50)"/>
            <column name="updated_at" type="timestamp"/>
            <column name="refresh_token" type="varchar(255)"/>
            <column name="token_expired_at" type="timestamp"/>
        </createTable>
    </changeSet>

    <changeSet id="2-insert-user-initial-data" author="copilot">
    <!-- db.json 기반 초기 데이터 insert, email/phone/status 등은 규칙적으로 생성 -->
        <insert tableName="users">
            <column name="id" value="Asparagus.cata"/>
            <column name="name" value="아스파라카타"/>
            <column name="dept" value="데이터팀"/>
            <column name="role" value="QA"/>
            <column name="email" value="Asparagus.cata@example.com"/>
            <column name="password" value="$2a$10$testpassword"/>
            <column name="last_login_at" value="2025-01-01T00:00:00"/>
            <column name="created_by" value="system"/>
            <column name="created_at" value="2025-01-01T00:00:00"/>
            <column name="updated_by" value="system"/>
            <column name="updated_at" value="2025-01-01T00:00:00"/>
            <column name="refresh_token" value=""/>
            <column name="token_expired_at" value="2025-12-31T23:59:59"/>
            <column name="phone" value="010-0000-0001"/>
            <column name="status" value="ACTIVE"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="seoyeon.choi"/>
            <column name="name" value="최서연"/>
            <column name="dept" value="경영지원"/>
            <column name="role" value="DevOps"/>
            <column name="email" value="seoyeon.choi@example.com"/>
            <column name="password" value="$2a$10$testpassword"/>
            <column name="last_login_at" value="2025-01-01T00:00:00"/>
            <column name="created_by" value="system"/>
            <column name="created_at" value="2025-01-01T00:00:00"/>
            <column name="updated_by" value="system"/>
            <column name="updated_at" value="2025-01-01T00:00:00"/>
            <column name="refresh_token" value=""/>
            <column name="token_expired_at" value="2025-12-31T23:59:59"/>
            <column name="phone" value="010-0000-0002"/>
            <column name="status" value="ACTIVE"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="hyunwoo.jang"/>
            <column name="name" value="장현우"/>
            <column name="dept" value="모바일팀"/>
            <column name="role" value="Data"/>
            <column name="email" value="hyunwoo.jang@example.com"/>
            <column name="password" value="$2a$10$testpassword"/>
            <column name="last_login_at" value="2025-01-01T00:00:00"/>
            <column name="created_by" value="system"/>
            <column name="created_at" value="2025-01-01T00:00:00"/>
            <column name="updated_by" value="system"/>
            <column name="updated_at" value="2025-01-01T00:00:00"/>
            <column name="refresh_token" value=""/>
            <column name="token_expired_at" value="2025-12-31T23:59:59"/>
            <column name="phone" value="010-0000-0003"/>
            <column name="status" value="ACTIVE"/>
        </insert>
        <!-- ... (db.json의 나머지 데이터도 동일 규칙으로 추가) ... -->
    </changeSet>

    <!-- 게시판 테이블 -->
    <changeSet id="3-create-posts-table" author="copilot">
        <createTable tableName="posts">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="content" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(20)" defaultValue="PUBLISHED">
                <constraints nullable="false"/>
            </column>
            <column name="view_count" type="int" defaultValue="0"/>
            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="timestamp"/>
        </createTable>
        <addForeignKeyConstraint
            baseTableName="posts"
            baseColumnNames="author_id"
            constraintName="fk_posts_author"
            referencedTableName="users"
            referencedColumnNames="id"
            onDelete="CASCADE"/>
        <createIndex tableName="posts" indexName="idx_posts_author">
            <column name="author_id"/>
        </createIndex>
        <createIndex tableName="posts" indexName="idx_posts_created">
            <column name="created_at"/>
        </createIndex>
    </changeSet>

    <!-- 댓글 테이블 -->
    <changeSet id="4-create-comments-table" author="copilot">
        <createTable tableName="comments">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="post_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="content" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="timestamp"/>
        </createTable>
        <addForeignKeyConstraint
            baseTableName="comments"
            baseColumnNames="post_id"
            constraintName="fk_comments_post"
            referencedTableName="posts"
            referencedColumnNames="id"
            onDelete="CASCADE"/>
        <addForeignKeyConstraint
            baseTableName="comments"
            baseColumnNames="parent_id"
            constraintName="fk_comments_parent"
            referencedTableName="comments"
            referencedColumnNames="id"
            onDelete="CASCADE"/>
        <addForeignKeyConstraint
            baseTableName="comments"
            baseColumnNames="author_id"
            constraintName="fk_comments_author"
            referencedTableName="users"
            referencedColumnNames="id"
            onDelete="CASCADE"/>
        <createIndex tableName="comments" indexName="idx_comments_post">
            <column name="post_id"/>
        </createIndex>
        <createIndex tableName="comments" indexName="idx_comments_parent">
            <column name="parent_id"/>
        </createIndex>
    </changeSet>

    <!-- 파일 테이블 -->
    <changeSet id="5-create-files-table" author="copilot">
        <createTable tableName="files">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="original_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="stored_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="file_path" type="varchar(500)">
                <constraints nullable="false"/>
            </column>
            <column name="file_size" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="content_type" type="varchar(100)"/>
            <column name="uploader_id" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="uploaded_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
        <addForeignKeyConstraint
            baseTableName="files"
            baseColumnNames="uploader_id"
            constraintName="fk_files_uploader"
            referencedTableName="users"
            referencedColumnNames="id"
            onDelete="CASCADE"/>
        <createIndex tableName="files" indexName="idx_files_uploader">
            <column name="uploader_id"/>
        </createIndex>
    </changeSet>

    <!-- 초기 게시글 데이터 -->
    <changeSet id="6-insert-posts-initial-data" author="copilot">
        <insert tableName="posts">
            <column name="title" value="첫 번째 게시글"/>
            <column name="content" value="안녕하세요, 첫 번째 게시글입니다."/>
            <column name="author_id" value="Asparagus.cata"/>
            <column name="status" value="PUBLISHED"/>
            <column name="view_count" value="10"/>
            <column name="created_at" value="2025-11-01T10:00:00"/>
        </insert>
        <insert tableName="posts">
            <column name="title" value="Spring Boot 학습 팁"/>
            <column name="content" value="Spring Boot를 효과적으로 학습하는 방법을 공유합니다."/>
            <column name="author_id" value="seoyeon.choi"/>
            <column name="status" value="PUBLISHED"/>
            <column name="view_count" value="25"/>
            <column name="created_at" value="2025-11-05T14:30:00"/>
        </insert>
        <insert tableName="posts">
            <column name="title" value="임시 저장 글"/>
            <column name="content" value="작성 중인 글입니다."/>
            <column name="author_id" value="hyunwoo.jang"/>
            <column name="status" value="DRAFT"/>
            <column name="view_count" value="0"/>
            <column name="created_at" value="2025-11-10T09:15:00"/>
        </insert>
    </changeSet>

    <!-- 초기 댓글 데이터 -->
    <changeSet id="7-insert-comments-initial-data" author="copilot">
        <insert tableName="comments">
            <column name="post_id" value="1"/>
            <column name="content" value="좋은 글이네요!"/>
            <column name="author_id" value="seoyeon.choi"/>
            <column name="created_at" value="2025-11-01T11:00:00"/>
        </insert>
        <insert tableName="comments">
            <column name="post_id" value="1"/>
            <column name="parent_id" value="1"/>
            <column name="content" value="감사합니다!"/>
            <column name="author_id" value="Asparagus.cata"/>
            <column name="created_at" value="2025-11-01T12:00:00"/>
        </insert>
        <insert tableName="comments">
            <column name="post_id" value="2"/>
            <column name="content" value="도움이 많이 되었습니다."/>
            <column name="author_id" value="hyunwoo.jang"/>
            <column name="created_at" value="2025-11-05T15:00:00"/>
        </insert>
    </changeSet>

    <!-- 설비 테이블 -->
    <changeSet id="8-create-equipment-table" author="copilot">
        <createTable tableName="equipment">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="equipment_code" type="varchar(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="equipment_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="equipment_type" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(20)" defaultValue="NORMAL">
                <constraints nullable="false"/>
            </column>
            <column name="position_x" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="position_y" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="floor" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="temperature" type="decimal(5,2)"/>
            <column name="pressure" type="decimal(5,2)"/>
            <column name="cycle_count" type="int" defaultValue="0"/>
            <column name="last_check_time" type="timestamp"/>
            <column name="description" type="varchar(500)"/>
        </createTable>
        <createIndex tableName="equipment" indexName="idx_equipment_code">
            <column name="equipment_code"/>
        </createIndex>
        <createIndex tableName="equipment" indexName="idx_equipment_floor">
            <column name="floor"/>
        </createIndex>
        <createIndex tableName="equipment" indexName="idx_equipment_status">
            <column name="status"/>
        </createIndex>
    </changeSet>

    <!-- 초기 설비 데이터 -->
    <changeSet id="9-insert-equipment-initial-data" author="copilot">
        <!-- 1층 - CVD 장비 -->
        <insert tableName="equipment">
            <column name="equipment_code" value="CVD-101"/>
            <column name="equipment_name" value="CVD 증착기 #1"/>
            <column name="equipment_type" value="CVD"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="100"/>
            <column name="position_y" value="100"/>
            <column name="floor" value="1F"/>
            <column name="temperature" value="850.5"/>
            <column name="pressure" value="0.8"/>
            <column name="cycle_count" value="1234"/>
            <column name="last_check_time" value="2025-01-20T10:00:00"/>
            <column name="description" value="메인 CVD 증착 장비"/>
        </insert>
        <insert tableName="equipment">
            <column name="equipment_code" value="CVD-102"/>
            <column name="equipment_name" value="CVD 증착기 #2"/>
            <column name="equipment_type" value="CVD"/>
            <column name="status" value="WARNING"/>
            <column name="position_x" value="300"/>
            <column name="position_y" value="100"/>
            <column name="floor" value="1F"/>
            <column name="temperature" value="920.8"/>
            <column name="pressure" value="1.2"/>
            <column name="cycle_count" value="2345"/>
            <column name="last_check_time" value="2025-01-20T10:05:00"/>
            <column name="description" value="고온 CVD 증착 장비"/>
        </insert>

        <!-- 1층 - Etching 장비 -->
        <insert tableName="equipment">
            <column name="equipment_code" value="ETCH-101"/>
            <column name="equipment_name" value="식각기 #1"/>
            <column name="equipment_type" value="ETCHING"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="500"/>
            <column name="position_y" value="100"/>
            <column name="floor" value="1F"/>
            <column name="temperature" value="25.3"/>
            <column name="pressure" value="0.001"/>
            <column name="cycle_count" value="3456"/>
            <column name="last_check_time" value="2025-01-20T10:02:00"/>
            <column name="description" value="플라즈마 식각 장비"/>
        </insert>
        <insert tableName="equipment">
            <column name="equipment_code" value="ETCH-102"/>
            <column name="equipment_name" value="식각기 #2"/>
            <column name="equipment_type" value="ETCHING"/>
            <column name="status" value="ERROR"/>
            <column name="position_x" value="700"/>
            <column name="position_y" value="100"/>
            <column name="floor" value="1F"/>
            <column name="temperature" value="35.7"/>
            <column name="pressure" value="0.002"/>
            <column name="cycle_count" value="4567"/>
            <column name="last_check_time" value="2025-01-20T09:55:00"/>
            <column name="description" value="드라이 식각 장비 (챔버 압력 이상)"/>
        </insert>

        <!-- 1층 - Lithography 장비 -->
        <insert tableName="equipment">
            <column name="equipment_code" value="LITHO-101"/>
            <column name="equipment_name" value="노광기 #1"/>
            <column name="equipment_type" value="LITHOGRAPHY"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="100"/>
            <column name="position_y" value="300"/>
            <column name="floor" value="1F"/>
            <column name="temperature" value="23.5"/>
            <column name="pressure" value="1.0"/>
            <column name="cycle_count" value="5678"/>
            <column name="last_check_time" value="2025-01-20T10:03:00"/>
            <column name="description" value="EUV 노광 장비"/>
        </insert>

        <!-- 2층 - Ion Implanter -->
        <insert tableName="equipment">
            <column name="equipment_code" value="ION-201"/>
            <column name="equipment_name" value="이온주입기 #1"/>
            <column name="equipment_type" value="ION_IMPLANT"/>
            <column name="status" value="MAINTENANCE"/>
            <column name="position_x" value="150"/>
            <column name="position_y" value="150"/>
            <column name="floor" value="2F"/>
            <column name="temperature" value="28.2"/>
            <column name="pressure" value="0.5"/>
            <column name="cycle_count" value="6789"/>
            <column name="last_check_time" value="2025-01-20T08:30:00"/>
            <column name="description" value="정기 유지보수 중"/>
        </insert>
        <insert tableName="equipment">
            <column name="equipment_code" value="ION-202"/>
            <column name="equipment_name" value="이온주입기 #2"/>
            <column name="equipment_type" value="ION_IMPLANT"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="400"/>
            <column name="position_y" value="150"/>
            <column name="floor" value="2F"/>
            <column name="temperature" value="26.8"/>
            <column name="pressure" value="0.4"/>
            <column name="cycle_count" value="7890"/>
            <column name="last_check_time" value="2025-01-20T10:01:00"/>
            <column name="description" value="고에너지 이온주입 장비"/>
        </insert>

        <!-- 2층 - CMP 장비 -->
        <insert tableName="equipment">
            <column name="equipment_code" value="CMP-201"/>
            <column name="equipment_name" value="CMP 연마기 #1"/>
            <column name="equipment_type" value="CMP"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="650"/>
            <column name="position_y" value="150"/>
            <column name="floor" value="2F"/>
            <column name="temperature" value="22.1"/>
            <column name="pressure" value="3.5"/>
            <column name="cycle_count" value="8901"/>
            <column name="last_check_time" value="2025-01-20T10:04:00"/>
            <column name="description" value="화학기계적 연마 장비"/>
        </insert>

        <!-- 3층 - 검사 장비 -->
        <insert tableName="equipment">
            <column name="equipment_code" value="INSP-301"/>
            <column name="equipment_name" value="웨이퍼 검사기 #1"/>
            <column name="equipment_type" value="INSPECTION"/>
            <column name="status" value="NORMAL"/>
            <column name="position_x" value="200"/>
            <column name="position_y" value="200"/>
            <column name="floor" value="3F"/>
            <column name="temperature" value="21.5"/>
            <column name="pressure" value="1.0"/>
            <column name="cycle_count" value="9012"/>
            <column name="last_check_time" value="2025-01-20T10:06:00"/>
            <column name="description" value="결함 검사 장비"/>
        </insert>
        <insert tableName="equipment">
            <column name="equipment_code" value="INSP-302"/>
            <column name="equipment_name" value="웨이퍼 검사기 #2"/>
            <column name="equipment_type" value="INSPECTION"/>
            <column name="status" value="OFFLINE"/>
            <column name="position_x" value="500"/>
            <column name="position_y" value="200"/>
            <column name="floor" value="3F"/>
            <column name="temperature" value="0"/>
            <column name="pressure" value="0"/>
            <column name="cycle_count" value="1023"/>
            <column name="last_check_time" value="2025-01-19T18:00:00"/>
            <column name="description" value="전원 꺼짐 상태"/>
        </insert>
    </changeSet>

</databaseChangeLog>
